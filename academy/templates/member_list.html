{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Student Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #f4f6f8;
      font-family: Arial, sans-serif;
    }

    .navbar-custom {
      background-color: #0d3b66;
      padding: 10px 20px;
    }

    .navbar-custom .navbar-brand {
      display: flex;
      align-items: center;
      color: #fff;
      font-weight: 700;
      font-size: 1.5rem;
      text-decoration: none;
    }

    .navbar-custom .navbar-brand img {
      height: 40px;
      margin-right: 10px;
    }

    .back-link {
      display: inline-block;
      margin: 15px 20px;
      font-size: 1.2rem;
      color: #0d3b66;
      text-decoration: none;
      font-weight: 600;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    h1 {
      text-align: center;
      margin: 0 0 20px 0;
      color: #0d3b66;
      font-weight: 700;
    }

    .filter-box {
      background: #fff;
      padding: 20px 25px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
      margin-bottom: 10px;
    }

    table {
      width: 95%;
      margin: auto;
      border-collapse: collapse;
      background: #1a1a1a;
      border-radius: 12px;
      overflow: hidden;
      color: #ffffff;
    }

    th,
    td {
      padding: 12px;
      text-align: center;
      border: 1px solid #333;
    }

    th {
      background-color: #2c2c2c;
      font-weight: 600;
    }

    tr:hover {
      background-color: #333333;
    }

    .print-buttons {
      text-align: right;
      margin: 10px 20px;
    }

    .btn-print {
      padding: 8px 16px;
      background: #0d3b66;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn-print:hover {
      background: #5d6fbd;
    }

    @media print {

      .filter-box,
      .print-buttons,
      h1,
      .navbar-custom,
      .back-link {
        display: none;
      }
    }
  </style>
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar-custom">
    <a href="#" class="navbar-brand">
      <img src="{% static 'images/logo_c.png' %}" alt="Logo">
      Prathibha College - Student Details
    </a>
  </nav>

  <a href="{% url 'tutor_dashboard' %}" class="back-link">&larr; Back</a>

  <h1>Student Details</h1>

  <!-- Filters -->
  <div class="filter-box container">
    <div class="row g-3 align-items-center justify-content-center">
      <div class="col-md-4 col-sm-12">
        <label for="nameSearch">Search by Name</label>
        <input type="text" id="nameSearch" class="form-control" placeholder="Enter name" onkeyup="filterStudents()">
      </div>

      <div class="col-md-4 col-sm-6">
        <label for="batchFilter">Filter by Batch</label>
        <select id="batchFilter" class="form-select" onchange="filterStudents()">
          <option value="all">All</option>
          <option value="Day Batch">Day Batch</option>
          <option value="Sunday Batch">Sunday Batch</option>
          <option value="Overseer (Sunday Only)">Overseer (Sunday Only)</option>
          <option value="Night Batch">Night Batch</option>
        </select>
      </div>

      <div class="col-md-4 col-sm-6">
        <label for="feesFilter">Filter by Fees</label>
        <select id="feesFilter" class="form-select" onchange="filterStudents()">
          <option value="all">All</option>
          <option value="Paid">Paid</option>
          <option value="Not Paid">Not Paid</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Print button -->
  <div class="print-buttons">
    <button class="btn-print" onclick="printTable()">üñ®Ô∏è Print</button>
  </div>

  <!-- Student Table -->
  <div class="table-responsive">
    <table id="studentsTable" class="table table-bordered">
      <thead>
        <tr>
          <th>Full Name</th>
          <th>Place</th>
          <th>Batch</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Date Joined</th>
          <th>Fees</th>
        </tr>
      </thead>
      <tbody>
        {% for student in students %}
        <tr data-batch="{{ student.batch }}">
          <td>{{ student.first_name }} {{ student.last_name }}</td>
          <td>{{ student.city }}, {{ student.state }}</td>
          <td>{{ student.batch }}</td>
          <td>{{ student.email }}</td>
          <td>{{ student.phone }}</td>
          <td>{{ student.date_joined|date:"Y-m-d" }}</td>
          <td>{{ student.fees_paid|yesno:"Paid,Not Paid" }}</td>
          <td>
            {% if request.user.is_staff %}
            <a href="{% url 'edit_student' student.id %}" class="btn btn-sm btn-warning">Edit</a>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center">No students found</td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>

  <script>
    function filterStudents() {
      const nameFilter = document.getElementById("nameSearch").value.toLowerCase();
      const batchFilter = document.getElementById("batchFilter").value;
      const feesFilter = document.getElementById("feesFilter").value;
      const rows = document.querySelectorAll("#studentsTable tbody tr");

      rows.forEach(row => {
        const rowName = row.querySelector("td:nth-child(1)").innerText.toLowerCase();
        const rowBatch = row.getAttribute("data-batch");
        const rowFees = row.querySelector("td:nth-child(7)").innerText;

        const nameMatch = rowName.includes(nameFilter);
        const batchMatch = (batchFilter === "all" || rowBatch === batchFilter);
        const feesMatch = (feesFilter === "all" || rowFees === feesFilter);

        row.style.display = (nameMatch && batchMatch && feesMatch) ? "" : "none";
      });
    }

    function printTable() {
      window.print();
    }
  </script>

</body>

</html>